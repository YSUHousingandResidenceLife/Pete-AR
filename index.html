<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pete — AR & Selfie 2D</title>
  <style>
    :root { --ysu:#cc0000; --bg:#000; --card:#101010; --muted:#888; --disabled:#555; }
    html,body { margin:0; height:100%; background:var(--bg); color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; }
    .wrap { min-height:100%; display:flex; align-items:center; justify-content:center; padding:22px; }
    .card { width:min(780px,94vw); background:var(--card); border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.4); padding:22px; }
    h1 { margin:0 0 6px; font-size:22px; }
    .row { display:grid; gap:14px; }
    .section { background:rgba(255,255,255,.04); border-radius:14px; padding:14px; }
    .title { font-weight:900; font-size:13px; letter-spacing:.2px; opacity:.95; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
    .badge { display:inline-block; font-size:11px; font-weight:900; padding:3px 8px; border-radius:999px; background:#fff; color:#000; }
    .muted { color:#ddd; opacity:.85; font-size:12px; }
    .btns { display:flex; flex-direction:column; gap:10px; }
    .btn { display:block; text-align:center; text-decoration:none; font-weight:800; padding:14px 16px; border-radius:999px; border:0; cursor:pointer; transition:transform .06s ease; }
    .btn:active { transform:scale(.98); }
    .primary { background:var(--ysu); color:#fff; }
    .light { background:#fff; color:#000; }
    .outline { background:transparent; color:#fff; box-shadow:inset 0 0 0 2px rgba(255,255,255,.18); }
    .disabled { background:var(--disabled) !important; color:#bbb !important; pointer-events:none; cursor:not-allowed; opacity:.7; }
    .tiny { font-size:11px; opacity:.9; }
    .spacer { height:8px; }
    .status { font-size:12px; }
    .lock { color:var(--muted); }
    .ok { color:#6afc93; }
    @media (min-width:640px){
      .pair { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Pete — AR & Selfie 2D</h1>

      <!-- STEP 1 -->
      <div class="section">
        <div class="title"><span class="badge">STEP 1</span> Quick unlock</div>
        <div class="btns pair">
          <a id="followBtn" class="btn light" href="https://www.instagram.com/ysu_hrl/" target="_blank" rel="noopener">Follow @ysu_hrl (first time)</a>
          <a id="viewBtn"   class="btn light" href="https://www.instagram.com/ysu_hrl/" target="_blank" rel="noopener">View & Like any post (returning)</a>
        </div>
        <div id="status" class="status lock tiny" style="margin-top:8px;">3D AR is locked. Do Step 1, then return here.</div>
      </div>

      <!-- STEP 2 -->
      <div class="row" style="margin-top:14px;">
        <!-- SELFIE MODE 2D -->
        <div class="section">
          <div class="title">
            <span class="badge">STEP 2</span> Selfie Mode <span class="badge">2D</span>
          </div>
          <div class="muted tiny" style="margin-bottom:8px;">Front camera + Pete sticker. Capture as a photo.</div>
          <a class="btn outline" href="selfie/">Open Selfie Mode 2D (Front Camera)</a>
        </div>

        <!-- 3D AR (rear camera) -->
        <div class="section">
          <div class="title">
            <span class="badge">STEP 2</span> 3D AR (rear camera)
          </div>
          <div class="muted tiny" style="margin-bottom:8px;">Unlocks after Step 1. Choose your device:</div>
          <div class="btns">
            <!-- iPHONE — AR Quick Look (Drive) -->
            <a id="iphoneBtn" class="btn primary disabled"
               href="#"
               data-href="https://drive.google.com/uc?export=download&id=1HiN4_EkPxDbUWEt2jcxWB85iZR8Y3X1C"
               rel="ar" aria-disabled="true" tabindex="-1">
              iPhone — 3D Pete in your space
            </a>

            <!-- ANDROID — Scene Viewer (Drive GLB) -->
            <a id="androidBtn" class="btn primary disabled"
               href="#"
               data-href="https://arvr.google.com/scene-viewer/1.0?file=https%3A%2F%2Fdrive.google.com%2Fuc%3Fexport%3Ddownload%26id%3D1yiHuNsmyVQ_BPvOOdRqFM3bWCu7zzmad&title=Pete&mode=ar_preferred"
               aria-disabled="true" tabindex="-1">
              Android — 3D Pete in your space
            </a>
          </div>
        </div>
      </div>

      <div class="spacer"></div>
      <div id="hint" class="tiny muted">Tip: after Follow or View/Like, come back to this page — you’ll see “Unlocked”.</div>
    </div>
  </div>

  <script>
    const followBtn  = document.getElementById('followBtn');
    const viewBtn    = document.getElementById('viewBtn');
    const androidBtn = document.getElementById('androidBtn');
    const iphoneBtn  = document.getElementById('iphoneBtn');
    const statusLine = document.getElementById('status');
    const hint       = document.getElementById('hint');

    const FLAG_KEY = 'ysu_hrl_engaged';
    const FLAG_TS  = 'ysu_hrl_engaged_ts';
    let pendingEngagement = false;

    function markEngaged() {
      try {
        sessionStorage.setItem(FLAG_KEY, '1');
        localStorage.setItem(FLAG_KEY, '1');
        localStorage.setItem(FLAG_TS, String(Date.now()));
      } catch(_) {}
    }

    function isRecentlyEngaged(minutes=120) {
      try {
        if (sessionStorage.getItem(FLAG_KEY) === '1') return true;
        const ts = parseInt(localStorage.getItem(FLAG_TS) || '0', 10);
        if (!isNaN(ts)) {
          const ageMin = (Date.now() - ts) / 60000;
          return ageMin <= minutes;
        }
      } catch(_) {}
      return false;
    }

    function unlock() {
      [androidBtn, iphoneBtn].forEach(el => {
        el.classList.remove('disabled');
        el.setAttribute('aria-disabled', 'false');
        el.setAttribute('tabindex', '0');
        el.setAttribute('href', el.getAttribute('data-href'));
      });
      statusLine.textContent = '3D AR is unlocked — choose iPhone or Android.';
      statusLine.classList.remove('lock'); statusLine.classList.add('ok');
      hint.textContent = 'Ready! Tap iPhone or Android for 3D, or use Selfie Mode 2D anytime.';
    }

    // Mark + unlock on click
    function onCTA() {
      pendingEngagement = true;
      markEngaged();
      unlock();
    }
    followBtn.addEventListener('click', onCTA, { passive: true });
    viewBtn  .addEventListener('click', onCTA, { passive: true });

    // If the page hides (user jumps to IG app), also mark engagement
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden' && pendingEngagement) {
        markEngaged();
      }
    });

    // Auto-unlock on return
    window.addEventListener('pageshow', () => {
      if (isRecentlyEngaged()) unlock();
      pendingEngagement = false;
    });
  </script>
</body>
</html>
